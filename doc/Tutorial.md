# FLEE coupled UQ tutorial

In this tutorial we will explain how you can combine a simple stochastic conflict evolution model (Flare) with an agent-based migration model (Flee), perform a set of runs based on different conflict evolutions, and visualize the migrant arrivals with confidence intervals.

## Prerequisites

To perform this tutorial you will require a Linux environment, and the following software packages:
* Flee
* Flare
* FabSim3
* The FabFlee plugin

Below you can find installation instructions for each of these tools.

### Installing Flee

For installation instructions, see http://www.github.com/djgroen/flee-release

We will assume that you will install Flee in a directory called <Flee Home>.

### Installing Flare

For this tutorial, you will need to install Flare on your local workstation.
For installation instructions, see http://www.github.com/djgroen/flare-release

We will assume that you will install FabSim3 in a directory called <Flare Home>.

### Installing FabSim3 and FabFlee

For installation instructions, see http://www.github.com/djgroen/FabSim3/INSTALL

Once you have installed FabSim3, you can install FabFlee by typing:

`fab localhost install_plugin:FabFlee`.

We will assume that you will install FabSim3 in a directory called <FabSim Home>.

## Configuration

Once you have installed the required dependencies, you will need to take a few small configuration steps:
1. Go to <FabSim Home>/deploy
2. Open `machines_user.yml`
3. Under the section `default:`, please add the following lines:
  a. flee_location=<Flee Home> #NOTE: please replace <Flee Home> with your actual install directory.
  b. flare_location=<Flare Home> #NOTE: please replace <Flee Home> with your actual install directory.

## Forced migration simulations: description

The workflow you will test out here involves the following:
1. We run a set of simple conflict evolution simulations (Flare) in the context of Mali.
2. We gather the conflict evolutions generated by this simulation, and convert them to create input for an ensemble of agent-based migration (Flee) simulation.
3. We run a Flee simulation for each conflict evolution generated.
4. We analyze and visualize a basic result.

# Executing simulations of population displacement

### run a single population displacement validation test

`fab localhost flee:mali,simulation_period=300`

### run an ensemble simulation, analyzing variability.

`fab localhost flee_ensemble:mali,simulation_period=300,N=10`

### run a coupled simulation with basic UQ

`fab localhost flee_conflict_forecast:mali,N=2,simulation_period=300`

# Going the next mile (optional content)

### Running the coupled simulation on a supercomputer

`fab eagle flee_conflict_forecast:mali,N=20,simulation_period=300`

### Running an ensemble simulation on a supercomputer using Pilot Jobs

`fab eagle flee_ensemble:mali,N=20,simulation_period=300,Pilot=true`

### Running an ensemble simulation on a supercomputer using Pilot Jobs and QCG Broker

`fab qcg flee_ensemble:mali,N=20,simulation_period=300,Pilot=true`
